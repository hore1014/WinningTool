<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="keywords" content="HTML, CSS" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <meta
      name="description"
      content="Mit dem Supply Chain Planer werden Bestellungen, Lagerhaltung, die Produktion und der Absatz geplant"
    />
    <title>Sales Prediction, Stock and Production Planer</title>
  </head>
  <body>
    <nav>
      <ul class="progressbar">
        <li class="active">
          <a href="1_lastPeriod.html">Vorherige Periode</a>
        </li>
        <li class="active">
          <a>Absatz-Prognosen und Produktionsplan</a>
        </li>
        <li>
          <a>Lager und Produktion der Zwischenerzeugnisse</a>
        </li>
        <li>
          <a>Produktionsreihenfolge und Splitting</a>
        </li>
        <li><a>Bestellungen</a></li>
        <li><a>Kapazität</a></li>
        <li><a>Finanzen</a></li>
      </ul>
    </nav>

    <form method="post">
      <div id="main-container" class="big-vertical-container">
        <!-- Absatz-Prognosen -->
        <h3>
          Geben Sie die Absatzprognosen für die aktuelle Periode (Periode {{
          period }}) und die darauffolgenden Perioden an.
        </h3>
        <table id="sales-table">
          <thead>
            <tr>
              <th>Produkte</th>
              <th>Aktuelle Periode</th>
              <th>Aktuell +1</th>
              <th>Aktuell +2</th>
              <th>Aktuell +3</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>P1</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P1_0"
                  value="{{ sales_P1_0 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P1_1"
                  value="{{ sales_P1_1 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P1_2"
                  value="{{ sales_P1_2 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P1_3"
                  value="{{ sales_P1_3 }}"
                />
              </td>
            </tr>
            <tr>
              <td>P2</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P2_0"
                  value="{{ sales_P2_0 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P2_1"
                  value="{{ sales_P2_1 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P2_2"
                  value="{{ sales_P2_2 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P2_3"
                  value="{{ sales_P2_3 }}"
                />
              </td>
            </tr>
            <tr>
              <td>P3</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P3_0"
                  value="{{ sales_P3_0 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P3_1"
                  value="{{ sales_P3_1 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P3_2"
                  value="{{ sales_P3_2 }}"
                />
              </td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="sales_P3_3"
                  value="{{ sales_P3_3 }}"
                />
              </td>
            </tr>
            <tr>
              <td><em>Summe</em></td>
              <td id="sum-0">0</td>
              <td id="sum-1">0</td>
              <td id="sum-2">0</td>
              <td id="sum-3">0</td>
            </tr>
          </tbody>
        </table>

        <!-- Lagerbestände und Produktion -->

        <h3>Geben Sie die Planendlagerbestände der Hauptprodukte an.</h3>
        <p>Daraus ergibt sich der Produktionsplan.</p>
        <table id="stock-and-production-table">
          <col />
          <colgroup span="2"></colgroup>
          <colgroup span="2"></colgroup>
          <thead>
            <tr>
              <th rowspan="2">Produkte</th>
              <th colspan="2">Aktuelle Periode</th>
              <th colspan="2">Aktuell +1</th>
              <th colspan="2">Aktuell +2</th>
              <th colspan="2">Aktuell +3</th>
            </tr>
            <tr>
              <th>Lager</th>
              <th>Produktion</th>
              <th>Lager</th>
              <th>Produktion</th>
              <th>Lager</th>
              <th>Produktion</th>
              <th>Lager</th>
              <th>Produktion</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>P1</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P1_0"
                  value="{{ stock_P1_0 }}"
                />
              </td>
              <td id="production_P1_0">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P1_1"
                  value="{{ stock_P1_1 }}"
                />
              </td>
              <td id="production_P1_1">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P1_2"
                  value="{{ stock_P1_2 }}"
                />
              </td>
              <td id="production_P1_2">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P1_3"
                  value="{{ stock_P1_3 }}"
                />
              </td>
              <td id="production_P1_3">0</td>
            </tr>
            <tr>
              <td>P2</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P2_0"
                  value="{{ stock_P2_0 }}"
                />
              </td>
              <td id="production_P2_0">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P2_1"
                  value="{{ stock_P2_1 }}"
                />
              </td>
              <td id="production_P2_1">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P2_2"
                  value="{{ stock_P2_2 }}"
                />
              </td>
              <td id="production_P2_2">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P2_3"
                  value="{{ stock_P2_3 }}"
                />
              </td>
              <td id="production_P2_3">0</td>
            </tr>
            <tr>
              <td>P3</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P3_0"
                  value="{{ stock_P3_0 }}"
                />
              </td>
              <td id="production_P3_0">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P3_1"
                  value="{{ stock_P3_1 }}"
                />
              </td>
              <td id="production_P3_1">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P3_2"
                  value="{{ stock_P3_2 }}"
                />
              </td>
              <td id="production_P3_2">0</td>
              <td class="editable" class="allow-number">
                <input
                  type="number"
                  name="stock_P3_3"
                  value="{{ stock_P3_3 }}"
                />
              </td>
              <td id="production_P3_3">0</td>
            </tr>
            <tr>
              <td><em>Summe</em></td>
              <td id="sum-stock-0">0</td>
              <td id="sum-production-0">0</td>
              <td id="sum-stock-1">0</td>
              <td id="sum-production-1">0</td>
              <td id="sum-stock-2">0</td>
              <td id="sum-production-2">0</td>
              <td id="sum-stock-3">0</td>
              <td id="sum-production-3">0</td>
            </tr>
          </tbody>
        </table>

        <br />

        <div name="collapsible">
          <button type="button" class="collapsible">
            <div style="position: relative">
              <div style="display: inline-block">
                <h3>Handelsplanung (optional)</h3>
                <p>
                  Hier könnnen Sie Kauf- oder Verkaufsteile mit anderen Firmen
                  planen.
                </p>
              </div>
              <div style="display: inline-block; float: right">
                <img
                  id="arrow-down"
                  src="{{ url_for('static', filename='img/downArrow.png') }}"
                />
              </div>
            </div>
          </button>

          <div class="content">
            <div id="error" hidden>
              <p class="error">
                Ein Artikel kann nicht gleichzeitig gekauft und verkauft werden.
              </p>
            </div>
            <div class="vertical-scrollable-table-wrapper">
              <table id="trade-table">
                <thead>
                  <tr>
                    <td>Artikel</td>
                    <td>Bestellmenge</td>
                    <td>Verkaufsmenge</td>
                    <td>
                      Preis <br />
                      (€ pro Stück)
                    </td>
                  </tr>
                </thead>
                <tbody id="trade-table-body">
                  {% for article in range(0, len) %}
                  <tr>
                    <td name="{{ 'article_' + all_parts[article] }}">
                      {{ all_parts[article] }}
                    </td>
                    <td class="editable">
                      <input
                        type="number"
                        name="{{ 'order_amount_' + all_parts[article] }}"
                        value="{{ 0 }}"
                      />
                    </td>
                    <td class="editable">
                      <input
                        type="number"
                        name="{{ 'sell_amount_' + all_parts[article] }}"
                        value="{{ 0 }}"
                      />
                    </td>
                    <td class="editable">
                      <input
                        type="number"
                        name="{{ 'price_' + all_parts[article] }}"
                        value="{{ 0 }}"
                      />
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
          <script>
            var coll = document.getElementsByClassName("collapsible");
            var i;

            for (i = 0; i < coll.length; i++) {
              coll[i].addEventListener("click", function () {
                this.classList.toggle("activated");
                var content = this.nextElementSibling;
                if (content.style.display === "block") {
                  content.style.display = "none";
                  document.getElementById("arrow-down").style.transform =
                    "rotate(0deg)";
                  document.getElementById("main-container").style.marginTop =
                    "0";
                } else {
                  content.style.display = "block";
                  document.getElementById("arrow-down").style.transform =
                    "rotate(180deg) translateY(5px)";
                  document.getElementById("main-container").style.marginTop =
                    "290px";
                }
              });
            }
          </script>
        </div>

        <script>
          /*
          const articleList = [
            "P1",
            "P2",
            "P3",
            "E4",
            "E5",
            "E6",
            "E7",
            "E8",
            "E9",
            "E10",
            "E11",
            "E12",
            "E13",
            "E14",
            "E15",
            "E16",
            "E17",
            "E18",
            "E19",
            "E20",
            "E26",
            "E29",
            "E30",
            "E31",
            "E49",
            "E50",
            "E51",
            "E54",
            "E55",
            "E56",
            "K21",
            "K22",
            "K23",
            "K24",
            "K25",
            "K27",
            "K28",
            "K32",
            "K33",
            "K34",
            "K35",
            "K36",
            "K37",
            "K38",
            "K39",
            "K40",
            "K41",
            "K42",
            "K43",
            "K44",
            "K45",
            "K46",
            "K47",
            "K48",
            "K52",
            "K53",
            "K57",
            "K58",
            "K59",
          ];

          // Fill Table with rows 
          var body = document.getElementById("trade-table-body");

          for (var i = 0; i < articleList.length; i++) {
            body.innerHTML +=
              '<tr><td name="article_' +
              articleList[i] +
              '">' +
              articleList[i] +
              '</td><td class="editable" ><input type="number" name="order_amount_' +
              articleList[i] +
              '" value="0"></td><td class="editable" ><input type="number" name="sell_amount_' +
              articleList[i] +
              '" value="0"/></td><td class="editable"><input type="number" name="price_' +
              articleList[i] +
              '" value="0"/></td></tr>';
          }
          */
        </script>

        <br class="spacing" />
      </div>

      <div hidden>
        <input
          type="number"
          name="before_P1"
          value="{{ inventory['P1'][0] }}"
        />
        <input
          type="number"
          name="before_P2"
          value="{{ inventory['P2'][0] }}"
        />
        <input
          type="number"
          name="before_P3"
          value="{{ inventory['P3'][0] }}"
        />
      </div>

      <br class="spacing" />

      <button
        id="continue-button"
        class="continue-button"
        type="submit"
        value="Upload"
        onclick="location.href='3_stockPlaner.html'"
      >
        Weiter
        <img
          id="continue-icon"
          src="{{ url_for('static', filename='img/continueArrow.png') }}"
        />
      </button>
    </form>

    <script>
      calculateForecastSums();
      calculateProductions();
      calculateStockAndProductionSums();

      document.addEventListener("keyup", function (event) {
        calculateForecastSums();
        calculateProductions();
        calculateStockAndProductionSums();
        checkBuyOrSell();
      });

      /* Calculate sums in forecast table */
      function calculateForecastSums() {
        var table = document.getElementById("sales-table");
        var cell = 0;
        var sum = 0;

        for (var column = 0; column < 4; column++) {
          sum = 0;

          for (var row = 1; row < table.rows.length - 1; row++) {
            cell = document.getElementsByName("sales_P" + row + "_" + column)[0]
              .value;

            if (cell.length == 0) {
              sum += 0;
            } else {
              sum += parseInt(cell);
            }
          }
          document.getElementById("sum-" + column).innerHTML = sum;
        }
      }

      /* Calculate Production Numbers in Table */
      function calculateProductions() {
        var salesTable = document.getElementById("sales-table");
        var stockAndProductionTable = document.getElementById(
          "stock-and-production-table"
        );
        var salesCell = 0;
        var stockCell = 0;
        var salesNumber = 0;
        var stockNumber = 0;
        var salesNumberBefore = 0;

        for (var column = 0; column < 4; column++) {
          for (var row = 1; row < salesTable.rows.length - 1; row++) {
            salesCell = document.getElementsByName(
              "sales_P" + row + "_" + column
            )[0].value;
            stockCell = document.getElementsByName(
              "stock_P" + row + "_" + column
            )[0].value;
            if (column > 0) {
              salesCellBefore = document.getElementsByName(
                "stock_P" + row + "_" + (column - 1)
              )[0].value;
            } else {
              salesCellBefore = document.getElementsByName("before_P" + row)[0]
                .value;
            }
            if (salesCell.length == 0) {
              salesNumber = 0;
            } else {
              salesNumber = parseInt(salesCell);
            }
            if (stockCell.length == 0) {
              stockNumber = 0;
            } else {
              stockNumber = parseInt(stockCell);
            }
            if (salesCellBefore.length == 0) {
              salesNumberBefore = 0;
            } else {
              salesNumberBefore = parseInt(salesCellBefore);
            }

            document.getElementById(
              "production_P" + row + "_" + column
            ).innerHTML = salesNumber + stockNumber - salesNumberBefore;
          }
        }
      }

      /* Calculate Production and Stock Sums in Table */
      function calculateStockAndProductionSums() {
        var table = document.getElementById("stock-and-production-table");
        var cell = 0;
        var sum = 0;

        for (var column = 0; column < 8; column++) {
          sum = 0;

          for (var row = 1; row < table.rows.length - 2; row++) {
            if (column % 2 == 0) {
              /* sum up stock columns */
              cell = document.getElementsByName(
                "stock_P" + row + "_" + column / 2
              )[0].value;

              if (cell.length == 0) {
                sum += 0;
              } else {
                sum += parseInt(cell);
              }
            } else {
              /* sum up production columns */
              cell = document.getElementById(
                "production_P" + row + "_" + (column - 1) / 2
              ).innerHTML;

              if (cell.length == 0) {
                sum += 0;
              } else {
                sum += parseInt(cell);
              }
            }
          }
          if (column % 2 == 0) {
            document.getElementById("sum-stock-" + column / 2).innerHTML = sum;
          } else {
            document.getElementById(
              "sum-production-" + (column - 1) / 2
            ).innerHTML = sum;
          }
        }
      }

      function checkBuyOrSell() {
        var tradeTable = document.getElementById("trade-table");
        var buy = 0;
        var sell = 0;
        var sum = 0;

        for (var row = 1; row < tradeTable.rows.length; row++) {
          buy =
            tradeTable.rows[row].cells[1].getElementsByTagName("input")[0]
              .value;
          sell =
            tradeTable.rows[row].cells[2].getElementsByTagName("input")[0]
              .value;
          // console.log(`buy: ${buy}, sell: ${sell}`);
          sum += buy * sell;
        }

        if (sum == 0) {
          document.getElementById("continue-button").hidden = false;
          document.getElementById("error").hidden = true;
        } else {
          document.getElementById("continue-button").hidden = true;
          document.getElementById("error").hidden = false;
        }
      }
    </script>
  </body>
  <footer>
    © IbSys2 Projekt von René Hopfe, David Böhm und Amelie Rempel, 2021
  </footer>
</html>
